(this.webpackJsonpchatapp=this.webpackJsonpchatapp||[]).push([[0],{108:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),s=a(12),o=a.n(s);a(87),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var i=a(41),c=a(35),l=a(31),u=a(14),p=a.n(u),m=a(26),h=a(16),d=a(17),f=a(19),g=a(18),b=a(20),x=a(134),v=a(138),C=a(50),w=a(149),E=a(140),y=a(150),O=a(141),j=a(5),k=function(e){return{paper:{padding:e.spacing(4),display:"flex",flexDirection:"column",alignItems:"center",width:"40vw",minWidth:"400px",position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"},form:{width:"100%",marginTop:e.spacing(1)},submit:{margin:e.spacing(3,0,2),padding:e.spacing(3),fontSize:"2em"},signup:{display:"block",textAlign:"center"},error:{textAlign:"center"}}},S=a(46),N=function(e){function t(){var e;return Object(h.a)(this,t),(e=Object(f.a)(this,Object(g.a)(t).call(this))).submitLogin=function(){var t=Object(m.a)(p.a.mark((function t(a){return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:a.preventDefault(),S.auth().signInWithEmailAndPassword(e.state.email,e.state.password).then((function(){e.props.history.push("/dashboard")}),(function(t){console.log(t),e.setState({loginError:"Server Error"})})),console.log("SUBMITTING",e.state);case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e.onChange=function(t){e.setState(Object(l.a)({},t.target.name,t.target.value))},e.state={email:null,password:null,loginError:""},e}return Object(b.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){var e=this,t=this.props.classes;return r.a.createElement(x.a,{className:t.paper},r.a.createElement(v.a,null),r.a.createElement(C.a,{variant:"h3"},"Login"),r.a.createElement("form",{onSubmit:function(t){return e.submitLogin(t)},className:t.form},r.a.createElement(w.a,{onChange:function(t){return e.onChange(t)},variant:"outlined",margin:"normal",fullWidth:!0,name:"email",label:"Email Address",id:"email",autoComplete:"email"}),r.a.createElement(w.a,{onChange:function(t){return e.onChange(t)},variant:"outlined",margin:"normal",fullWidth:!0,name:"password",label:"Password",type:"password",id:"password",autoComplete:"current-password"}),r.a.createElement(E.a,{control:r.a.createElement(y.a,{value:"remember",color:"primary"}),label:"Remember me"}),r.a.createElement(O.a,{type:"submit",fullWidth:!0,variant:"contained",color:"primary",className:t.submit},"Login")),this.state.loginError?r.a.createElement(C.a,{color:"secondary",className:t.error},this.state.loginError):null,r.a.createElement(i.b,{to:"/signup",variant:"body2",className:t.signup},"Don't have an account? Sign Up"))}}]),t}(n.Component),B=Object(j.a)(k)(N),M=function(e){return{paper:{padding:e.spacing(4),display:"flex",flexDirection:"column",alignItems:"center",width:"40vw",minWidth:"400px",position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"},header:{textAlign:"center"},form:{width:"100%",marginTop:e.spacing(1)},submit:{margin:e.spacing(3,0,2),padding:e.spacing(3),fontSize:"2em"},login:{display:"block",textAlign:"center"},error:{textAlign:"center"}}},W=a(46),T=function(e){function t(){var e;return Object(h.a)(this,t),(e=Object(f.a)(this,Object(g.a)(t).call(this))).submitSignup=function(t){t.preventDefault(),e.state.password===e.state.passwordConfirmation?W.auth().createUserWithEmailAndPassword(e.state.email,e.state.password).then((function(t){var a={email:t.user.email};W.firestore().collection("users").doc(e.state.email).set(a).then((function(){e.props.history.push("/dashboard")}),(function(t){console.log(t),e.setState({signupError:"Failed to add user"})}))}),(function(t){console.log(t.message),e.setState({signupError:t.message})})):e.setState({signupError:"Passwords do not match!"})},e.onChange=function(t){e.setState(Object(l.a)({},t.target.name,t.target.value))},e.state={email:null,password:null,passwordConfirmation:null,signupError:""},e}return Object(b.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){var e=this,t=this.props.classes;return r.a.createElement(x.a,{className:t.paper},r.a.createElement(v.a,null),r.a.createElement(C.a,{className:t.header,variant:"h3"},"Create a new Account"),r.a.createElement("form",{onSubmit:function(t){return e.submitSignup(t)},className:t.form},r.a.createElement(w.a,{onChange:function(t){return e.onChange(t)},variant:"outlined",required:!0,margin:"normal",fullWidth:!0,name:"email",label:"Email Address",id:"email",autoComplete:"email"}),r.a.createElement(w.a,{onChange:function(t){return e.onChange(t)},variant:"outlined",required:!0,margin:"normal",fullWidth:!0,name:"password",label:"Password",type:"password",id:"password",autoComplete:"current-password"}),r.a.createElement(w.a,{onChange:function(t){return e.onChange(t)},variant:"outlined",required:!0,margin:"normal",fullWidth:!0,name:"passwordConfirmation",label:"Confirm Password",type:"password",id:"passwordConfirmation",autoComplete:"current-password"}),r.a.createElement(O.a,{type:"submit",fullWidth:!0,variant:"contained",color:"primary",className:t.submit},"Join")),this.state.signupError?r.a.createElement(C.a,{color:"secondary",className:t.error},this.state.signupError):null,r.a.createElement(i.b,{to:"/",variant:"body2",className:t.login},"Do you have an account? Sign in"))}}]),t}(n.Component),A=Object(j.a)(M)(T),I=a(139),V=a(142),z=a(143),K=a(151),D=a(144),P=a(146),U=a(145),F=function(e){return{root:{backgroundColor:e.palette.background.paper,height:"100%",position:"absolute",left:"0",width:"300px",boxShadow:"0px 0px 2px black"},listItem:{cursor:"pointer","&:hover":{backgroundColor:"#eee"}},newChatBtn:{borderRadius:"0px",height:"50px"},unreadMessage:{color:"red",position:"absolute",top:"15px",right:"5px"}}},L=function(e){function t(){var e,a;Object(h.a)(this,t);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(a=Object(f.a)(this,(e=Object(g.a)(t)).call.apply(e,[this].concat(r)))).userIsSender=function(e){return e.messages[0].sender===a.props.userEmail},a.newChat=function(){return a.props.chatBtnClicked()},a.selectChat=function(e){return a.props.selectChat(e)},a}return Object(b.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){var e=this,t=this.props.classes;return r.a.createElement("div",{className:t.root},r.a.createElement(O.a,{variant:"contained",fullWidth:!0,color:"primary",onClick:this.newChat,className:t.newChatBtn},"New Message"),r.a.createElement(I.a,null,this.props.chats.map((function(a,n){return r.a.createElement("div",{key:n},r.a.createElement(V.a,{button:!0,onClick:function(){return e.selectChat(n)},className:t.listItem,selected:e.props.chatIndex===n,alignItems:"flex-start"},r.a.createElement(z.a,null,r.a.createElement(K.a,null,a.users.filter((function(t){return t!==e.props.userEmail}))[0].split("")[0])),r.a.createElement(D.a,{primary:a.users.filter((function(t){return t!==e.props.userEmail}))[0],secondary:r.a.createElement(r.a.Fragment,null,r.a.createElement(C.a,{component:"span",color:"textPrimary"},a.messages[0].message.substring(0,30)+" ..."))})),!1!==a.read||e.userIsSender(a)?null:r.a.createElement(U.a,{className:t.unreadMessage}),r.a.createElement(P.a,null))}))))}}]),t}(n.Component),R=Object(j.a)(F)(L),q=function(e){return{signOut:{position:"absolute",bottom:"0px",left:"0px",width:"300px",borderRadius:"0px",height:"50px",boxShadow:"0px 0px 2px black"}}},G=a(147),J=function(e){return{content:{height:"100vh",marginLeft:"300px",boxSizing:"border-box",width:"calc(100% - 300px)",padding:"25px 0px",paddingTop:"50px"},back:{position:"absolute",right:"1vw",top:"12px",cursor:"pointer","&:hover":{transform:"scale(1.2,1.2)"}},header:{boxShadow:"0px 0px 2px black",boxSizing:"border-box",position:"absolute",left:"300px",top:"0",textAlign:"center",color:"#fff",padding:"12px 16px",width:"calc(100% - 300px)",borderRadius:"0px",height:"50px",backgroundColor:"#3F51B5"},messagesList:{gridArea:"messagesList",boxSizing:"border-box",height:"calc(100% - 25px)",display:"flex",flexDirection:"column-reverse",padding:"25px",margin:" 0px",width:"100%",overflow:"auto",overflowY:"scroll"},userMsg:{float:"right",clear:"both",padding:"20px",boxSizing:"border-box",wordWrap:"break-word",marginTop:"10px",backgroundColor:"#3F51B5",color:"white",width:"300px",borderRadius:"10px"},friendMsg:{padding:"20px",boxSizing:"border-box",wordWrap:"break-word",marginTop:"10px",backgroundColor:"#eee",color:"#111",width:"300px",borderRadius:"10px",justifyitems:"start"}}},Q=function(e){function t(){var e,a;Object(h.a)(this,t);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(a=Object(f.a)(this,(e=Object(g.a)(t)).call.apply(e,[this].concat(r)))).onClick=function(){return a.props.hideChat()},a}return Object(b.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){var e=this.props,t=e.classes,a=e.chat,n=e.user;return void 0===a?r.a.createElement("main",{className:t.content}):r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:t.header},a.users.filter((function(e){return e!==n}))[0],r.a.createElement(G.a,{className:t.back,onClick:this.onClick})),r.a.createElement("main",{className:t.content},r.a.createElement("div",{className:t.messagesList},a.messages.map((function(e,a){return r.a.createElement("div",{key:a},r.a.createElement("div",{key:a,className:e.sender===n?t.userMsg:t.friendMsg},e.message))})))))}}]),t}(n.Component),X=Object(j.a)(J)(Q),Y=a(148),Z=function(e){return{sendButton:{position:"absolute",right:"0px",top:"0px",color:"blue",cursor:"pointer","&:hover":{color:"gray"}},chatBoxContainer:{position:"absolute",bottom:"5px",left:"315px",boxSizing:"border-box",overflow:"auto",width:"calc(100% - 300px - 20px)"},chatBox:{width:"calc(100% - 25px)"}}},$=function(e){function t(){var e;return Object(h.a)(this,t),(e=Object(f.a)(this,Object(g.a)(t).call(this))).onKeyUp=function(t){return 13===t.keyCode?e.submitMessage():e.setState({text:t.target.value})},e.isValid=function(e){return e&&e.replace(/\s/g,"").length},e.submitMessage=function(t){e.isValid(e.state.text)&&(e.props.submitMessage(e.state.text),document.querySelector("#chatBox").value="")},e.state={text:""},e}return Object(b.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){var e=this,t=this.props.classes;return r.a.createElement("div",{className:t.chatBoxContainer},r.a.createElement(w.a,{id:"chatBox",className:t.chatBox,placeholder:"Type your message...",onKeyUp:function(t){return e.onKeyUp(t)}}),r.a.createElement(Y.a,{onClick:this.submitMessage,className:t.sendButton}))}}]),t}(n.Component),H=Object(j.a)(Z)($),_=function(e){return{paper:{padding:e.spacing(4),display:"flex",flexDirection:"column",alignItems:"center",width:"40vw",minWidth:"400px",position:"absolute",top:"50%",left:"calc(50% + 150px)",transform:"translate(-50%, -50%)"},form:{width:"100%",marginTop:e.spacing(1)},submit:{margin:e.spacing(3,0,2),padding:e.spacing(3),fontSize:"2em"}}},ee=a(46),te=function(e){function t(){var e;return Object(h.a)(this,t),(e=Object(f.a)(this,Object(g.a)(t).call(this))).onChange=function(t){e.setState(Object(l.a)({},t.target.name,t.target.value))},e.userExists=Object(m.a)(p.a.mark((function t(){var a,n;return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,ee.firestore().collection("users").get();case 2:return a=t.sent,n=a.docs.map((function(e){return e.data().email})).includes(e.state.friendemail),e.setState({serverError:!n}),t.abrupt("return",n);case 6:case"end":return t.stop()}}),t)}))),e.chatExists=Object(m.a)(p.a.mark((function t(){var a,n;return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=e.createChatKey(),console.log("chatKey: ".concat(a)),t.next=4,ee.firestore().collection("chats").doc(a).get();case 4:return n=t.sent,console.log(n.exists),t.abrupt("return",n.exists);case 7:case"end":return t.stop()}}),t)}))),e.sendMessage=function(){var t=Object(m.a)(p.a.mark((function t(a){return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a.preventDefault(),t.next=3,e.userExists();case 3:if(!t.sent){t.next=9;break}return t.next=7,e.chatExists();case 7:t.sent?e.goToChat():e.createChat();case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e.createChat=function(){e.props.newChat({sendTo:e.state.friendemail,message:e.state.message})},e.goToChat=function(){return e.props.goToChat(e.createChatKey(),e.state.message)},e.createChatKey=function(){return[ee.auth().currentUser.email,e.state.friendemail].sort().join(":")},e.state={friendemail:"",message:""},e}return Object(b.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){var e=this,t=this.props.classes;return r.a.createElement(x.a,{className:t.paper},r.a.createElement(C.a,{component:"h1",variant:"h5"},"Send a message!"),r.a.createElement("form",{className:t.form,onSubmit:function(t){return e.sendMessage(t)}},r.a.createElement(w.a,{onChange:function(t){return e.onChange(t)},variant:"outlined",margin:"normal",fullWidth:!0,name:"friendemail",label:"Email Address",id:"friendemail",autoComplete:"email"}),r.a.createElement(w.a,{onChange:function(t){return e.onChange(t)},variant:"outlined",margin:"normal",fullWidth:!0,name:"message",label:"Enter your message",id:"message"}),r.a.createElement(O.a,{fullWidth:!0,variant:"contained",className:t.submit,color:"primary",type:"submit"},"Send")),this.state.serverError?r.a.createElement(C.a,{component:"h5",variant:"h6",color:"secondary"},"User doesn't exist"):null)}}]),t}(n.Component),ae=Object(j.a)(_)(te),ne=a(46),re=function(e){function t(){var e;return Object(h.a)(this,t),(e=Object(f.a)(this,Object(g.a)(t).call(this))).signOut=function(e){ne.auth().signOut()},e.selectChat=function(){var t=Object(m.a)(p.a.mark((function t(a){return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.setState({selectedChat:a,chatVisible:!0,newChatVisible:!1});case 2:console.log(e.state),e.messageRead();case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e.submitMessage=function(t){var a=e.createChatKey(e.state.chats[e.state.selectedChat].users.filter((function(t){return t!==e.state.email}))[0]);ne.firestore().collection("chats").doc(a).update({messages:ne.firestore.FieldValue.arrayUnion({message:t,sender:e.state.email,timestamp:Date.now()}),read:!1})},e.createChatKey=function(t){return[e.state.email,t].sort().join(":")},e.chatBtnClicked=function(){return e.setState({newChatVisible:!0,selectedChat:null})},e.hideChat=function(){return e.setState({selectedChat:null})},e.messageRead=function(){var t=e.createChatKey(e.state.chats[e.state.selectedChat].users.filter((function(t){return t!==e.state.email}))[0]);e.lastMessageNotWriteSender(e.state.selectedChat)?ne.firestore().collection("chats").doc(t).update({read:!0}):console.log("User is sender")},e.goToChat=function(){var t=Object(m.a)(p.a.mark((function t(a,n){var r,s;return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=a.split(":"),s=e.state.chats.find((function(e){return r.every((function(t){return e.users.includes(t)}))})),e.setState({chatVisible:!0}),t.next=5,e.selectChat(e.state.chats.indexOf(s));case 5:e.submitMessage(n),console.log("goToChat");case 7:case"end":return t.stop()}}),t)})));return function(e,a){return t.apply(this,arguments)}}(),e.newChat=function(){var t=Object(m.a)(p.a.mark((function t(a){var n;return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.createChatKey(a.sendTo),t.next=3,ne.firestore().collection("chats").doc(n).set({read:!1,users:[e.state.email,a.sendTo],messages:[{message:a.message,sender:e.state.email}]});case 3:e.setState({newChatVisible:!1,chatVisible:!0}),e.selectChat(e.state.chats.length-1),console.log("newChat");case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e.lastMessageNotWriteSender=function(t){return e.state.chats[t].messages[0].sender!==e.state.email},e.componentDidMount=function(){ne.auth().onAuthStateChanged(function(){var t=Object(m.a)(p.a.mark((function t(a){return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a){t.next=4;break}e.props.history.push("/login"),t.next=6;break;case 4:return t.next=6,ne.firestore().collection("chats").where("users","array-contains",a.email).onSnapshot(function(){var t=Object(m.a)(p.a.mark((function t(n){var r;return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(r=n.docs.map((function(e){return e.data()}))).forEach((function(e){return e.messages.reverse()})),t.next=4,e.setState({email:a.email,chats:r});case 4:console.log(e.state);case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())},e.state={selectedChat:null,chatVisible:!1,newChatVisible:!1,email:null,chats:[]},e}return Object(b.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){var e,t=this.props.classes;return r.a.createElement("div",null,r.a.createElement(R,(e={history:this.props.history,chats:this.state.chats,userEmail:this.state.email,selectChat:this.selectChat,chatBtnClicked:this.chatBtnClicked},Object(l.a)(e,"chats",this.state.chats),Object(l.a)(e,"chatIndex",this.state.selectedChat),e)),this.state.chatVisible?r.a.createElement(X,{hideChat:this.hideChat,user:this.state.email,chat:this.state.chats[this.state.selectedChat]}):null,null!==this.state.selectedChat&&!1!==this.state.chatVisible?r.a.createElement(H,{submitMessage:this.submitMessage}):null,this.state.newChatVisible?r.a.createElement(ae,{goToChat:this.goToChat,newChat:this.newChat}):null,r.a.createElement(O.a,{variant:"contained",fullWidth:!0,color:"primary",onClick:this.signOut,className:t.signOut},"signOut"))}}]),t}(n.Component),se=Object(j.a)(q)(re),oe=a(73),ie=function(e){function t(){return Object(h.a)(this,t),Object(f.a)(this,Object(g.a)(t).apply(this,arguments))}return Object(b.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){var e={num:[4,7],rps:.1,radius:[5,40],life:[1.5,3],v:[2,3],tha:[-40,40],alpha:[.6,0],scale:[.1,.4],position:"all",color:["#0000FF"],cross:"dead",random:15};return Math.random()>.85&&(e=Object.assign(e,{onParticleUpdate:function(e,t){e.beginPath(),e.rect(t.p.x,t.p.y,2*t.radius,2*t.radius),e.fillStyle=t.color,e.fill(),e.closePath()}})),r.a.createElement(r.a.Fragment,null,r.a.createElement(oe.a,{type:"custom",config:e,bg:!0}))}}]),t}(n.Component),ce=a(46);a(107),ce.initializeApp({apiKey:"AIzaSyA6Ccjz0pBXgQlerA7Tj7BnyzboTGsajOQ",authDomain:"chat-app-1ecbc.firebaseapp.com",databaseURL:"https://chat-app-1ecbc.firebaseio.com",projectId:"chat-app-1ecbc",storageBucket:"chat-app-1ecbc.appspot.com",messagingSenderId:"933134151767",appId:"1:933134151767:web:68b14b42369a741ff03312",measurementId:"G-12BCPKQMZP"});var le=r.a.createElement(i.a,null,r.a.createElement("div",{id:"routing-container"},r.a.createElement(ie,null),r.a.createElement(c.a,{path:"/",component:B}),r.a.createElement(c.a,{path:"/signup",component:A}),r.a.createElement(c.a,{path:"/dashboard",component:se})));o.a.render(le,document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},82:function(e,t,a){e.exports=a(108)},87:function(e,t,a){}},[[82,1,2]]]);
//# sourceMappingURL=main.5e1d9305.chunk.js.map